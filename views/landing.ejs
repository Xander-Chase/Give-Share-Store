<%- include("metadata") %>
<html lang="en" >
    <%- include("searchNavBar", {isLoggedIn, isAdmin}) %>
    <body>

    <!-- Filters -->
    <div class="col" style="width: 15%; position: fixed;">
        <div class="container">
            <div class="col"> <!-- TODO: Use EJS Template -->
                <% for (i = 0; i < filterHeaders.length; i++) { %>
                    <div class="col accordion w-100">
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="heading<%= filterHeaders[i] %>">
                                <button class="accordion-button bg-light" type="button" data-bs-toggle="collapse" data-bs-target="#<%= filterHeaders[i] %>" aria-expanded="true" aria-controls="<%= filterHeaders[i] %>">
                                    <strong><%= filterHeaders[i] %></strong> <!-- TODO: Variable -->
                                </button>
                            </h2>
                            <div id="<%= filterHeaders[i] %>" class="accordion-collapse collapse show" aria-labelledby="heading<%= filterHeaders[i] %>" data-bs-parent="#accordionExample">
                                <div class="accordion-body">
                                    <!-- TODO: Session Cookies because based on the collection search, only show the existing categories or just use node again -->
                                    <!-- TODO: Variable-->
                                    <%- filterStuff[i] %>
                                </div>
                            </div>
                        </div>
                    </div>
                <% } %>
                <br>
                <div class="d-flex justify-content-center gap-3">
                    <form method="post" onsubmit="this.action = `/price=${document.getElementById('selectedPrice').value}`;">
                        <button type="submit" class="btn btn-primary">Confirm</button>
                    </form>
                    <form method="post" onsubmit="this.action = '/clearFilter';">
                        <button type="submit" class="btn btn-danger">Clear</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid d-grid gap-1 align-items-center"
         style="grid-template-rows: 1fr 0.4fr 0.3fr 1fr; grid-template-columns: 18% 70%;">

        <!-- Slide Banner -->
        <div class="col" style="grid-column-start: 2">
            <div id="myCarousel" class="carousel slide mb-6 pointer-event" data-bs-ride="carousel">
                <div class="carousel-indicators">
                    <button type="button" data-bs-target="#myCarousel" data-bs-slide-to="0" class="" aria-label="Slide 1"></button>
                    <button type="button" data-bs-target="#myCarousel" data-bs-slide-to="1" aria-label="Slide 2" class=""></button>
                    <button type="button" data-bs-target="#myCarousel" data-bs-slide-to="2" aria-label="Slide 3" class="active" aria-current="true"></button>
                </div>

                <div class="carousel-inner">
                    <% let sampleSlogan = ["Explore", "Browse Collection", "Shop Now"]; %>
                    <% let sampleBanners = [
                        "/img/landingPage/banner/giveandshareBanner.png",
                        "https://media.istockphoto.com/id/1227531351/photo/summer-banner-sunny-sand-with-palm-leaves-in-tropical-beach.jpg?s=612x612&w=0&k=20&c=PM5uFqeefOvstaSrFUGPOArZR9QfMTCHlAMr4yRoFDk=",
                        "https://jdmyblog.s3.amazonaws.com/wp-content/uploads/2022/06/TOP-BANNER-5.jpg"
                    ]; %>
                    <% let sampleDescriptions = [
                        "The Vintage Garage!",
                        "It's that time of the Month, we have our freshly and chilly Summer collection! Great for your picnic and travels!",
                        "Check out the new jordan collection in The Vintage Garage!"
                    ]; %>
                    <% for (let i = 0; i < 3; i++) { %>
                        <% let status = ""; %>
                        <% if (i < 1) { %>
                            <% status = "active" %>
                        <% } %>
                        <%- include("templates/carouselBanner", {activeStatus: status, description: sampleDescriptions[i], slogan: sampleSlogan[i], source: sampleBanners[i]}) %>
                    <% } %>
                </div>

                <button class="carousel-control-prev" type="button" data-bs-target="#myCarousel" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#myCarousel" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
            </div>
        </div>

        <div class="container mt-1" style="grid-column-start: 2; grid-column-end: 3">
            <h1>Welcome to The Vintage Garage!</h1>
            <h2>Current Listings</h2>
        </div>

        <div class="container-fluid d-grid align-items-center text-center"
             style="grid-template-columns: 25% 75%; grid-column-end: 3; grid-column-start: 1;">

            <div class="col-md-7"></div>
            <!-- FIXME: Add Space for the right side of the page -->
            <div class="row row-cols-1">
                <% currentListings.forEach(function(item) { %>
                    <div class="col-3 row-3">
                        <div class="card shadow-sm" style="height: 100%">
                            <img class="bd-placeholder-img card-img-top" width="286rem" height="286rem"
                                 src="<%= item.product_img_URL[0] %>"
                                 alt="<%= item.item_title %>" />
                            <div class="card-body">
                                <h3 class="">
                                    <%= item.item_title %>
                                </h3>
                                <div class="d-flex justify-content-between align-items-center">
                                    <div class="btn-group">
                                        <a href="/product-info/<%= item._id %>" class="btn btn-sm btn-outline-secondary">View</a>
                                        <button type="button" class="btn btn-sm btn-outline-secondary" onclick="addToCart('<%= item._id %>')">Add to Cart</button>
                                    </div>
                                    <strong class="text-body-primary">
                                        CAN <%= item.item_price %>
                                    </strong>
                                </div>
                            </div>
                        </div>
                    </div>
                <% }); %>
            </div>
        </div>

        <div class="col text-center">
        </div>

    </div>
    </body>
    <script>
        function addToCart(itemId) {
            fetch('/add-to-cart', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ itemId: itemId })
            }).then(response => response.json())
              .then(data => {
                  if (data.success) {
                      document.getElementById('cart-item-count').innerText = data.cartItemCount;
                  } else {
                      alert(data.message);
                  }
              }).catch(error => {
                  console.error('Error adding item to cart:', error);
              });
        }
    </script>
</html>
